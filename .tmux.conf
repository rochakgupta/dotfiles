# Set a different prefix key
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable full mouse support
set -g mouse on

# Address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0

# Set maximum number of lines in window history
set -g history-limit 50000

# Increase tmux messages display duration from 750ms to 4s
set -g display-time 4000

# Refresh 'status-left' and 'status-right' more often, from every 15s to 5s
set -g status-interval 5

# Set default terminal (fallbacks to $TERM)
set -g default-terminal "xterm-256color"

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Move status bar to the top
set -g status-position top

# Ensure window titles get renamed automatically
setw -g automatic-rename

# Ensure window index numbers get reordered on delete
set -g renumber-windows on

# Start windows and panes index at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Required by tmux-yank plugin
set -s set-clipboard on

# Use vi bindings in copy mode
setw -g mode-keys vi

# Vi bindings for selecting and copying in copy mode
bind -T copy-mode-vi 'v' send -X begin-selection
bind -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window

# Better bindings to split windows
bind '\' split-window -h
bind '-' split-window -v

# Binding to source tmux config
bind r \
    source-file ~/.tmux.conf\; \
    display ".tmux.conf sourced"

# Bindings to move current window one position left or right
bind-key -r "<" swap-window -d -t -1
bind-key -r ">" swap-window -d -t +1

# Bindings to split windows with initial path as path of current pane
bind '|' split-window -h -c '#{pane_current_path}'
bind '_' split-window -v -c '#{pane_current_path}'

# Bindings to create new window with initial path as path of current pane
bind C new-window -c '#{pane_current_path}'

# Binding to toggle synchronize-panes on and off
bind C-y \
    setw synchronize-panes\; \
    display "synchronize-panes #{?synchronize-panes,on,off}"

# Binding to send command to all panes of current window
bind C-t \
    command-prompt -p "Command:" \
    "run \"tmux list-panes -F '##{session_name}:##{window_index}.##{pane_index}' \
        | xargs -I PANE tmux send-keys -t PANE '%1' Enter\""

# Binding to send command to all panes of all windows of current session
bind C-w \
    command-prompt -p "Command:" \
    "run \"tmux list-panes -s -F '##{session_name}:##{window_index}.##{pane_index}' \
        | xargs -I PANE tmux send-keys -t PANE '%1' Enter\""

# Binding to send command to all panes of all windows of all sessions
bind C-b \
    command-prompt -p "Command:" \
    "run \"tmux list-panes -a -F '##{session_name}:##{window_index}.##{pane_index}' \
        | xargs -I PANE tmux send-keys -t PANE '%1' Enter\""

################################################################################
# Plugin Management:
# tpm: https://github.com/tmux-plugins/tpm
################################################################################
# Plugins and their configurations

# TMUX plugin manager comes first
# Prefix + I = Install
# Prefix + U = Update
# Prefix + u = Clean
set -g @plugin 'tmux-plugins/tpm'
set -g @tpm-clean 'u'

# Gruvbox colorscheme
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark'

# Tokyonight colorscheme
set -g @plugin 'cappyzawa/tmux-tokyonight'

# Save and restore sessions
# Prefix + Ctrl-s = Save
# Prefix + Ctrl-r = Restore
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'

# Yank to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank_action 'copy-pipe'

# Easymotion in copy mode
# Prefix + Space-<motion> in copy mode = Trigger
set -g @plugin 'IngoMeyer441/tmux-easy-motion'
set -g @easy-motion-prefix 'Space'

# Select, copy, insert, complete text
# Prefix + Tab = Trigger
#   Tab in popup = Yank selection
#   Enter in popup = Insert selection
set -g @plugin 'laktak/extrakto'
set -g @extrakto_key 'tab'
set -g @extrakto_fzf_tool 'fzf --height 100% --border=sharp'
set -g @extrakto_popup_size '75%,50%'
set -g @extrakto_copy_key 'tab'
set -g @extrakto_insert_key 'enter'
set -g @extrakto_clip_tool_run 'tmux_osc52'

# Search scrollback buffer
# Prefix + b = Trigger
set -g @plugin 'roosta/tmux-fuzzback'
set -g @fuzzback-finder 'fzf'
set -g @fuzzback-bind 'b'
set -g @fuzzback-popup 1
set -g @fuzzback-popup-size '95%,50%'

# Utilities for manipulating sessions
# Prefix + g = Prompt for session name and switches to it. Performs 'kind-of' name completion.
# Prefix + S = Prompt for creating a new session by name.
# Prefix + X = Kill current session without detaching tmux.
# Prefix + @ = Promote current pane into a new session. Analogous to how ! breaks current pane to a new window.
# Prefix + t<secondary-key> = Join currently marked pane (Prefix + m) to current session/window, and switch to it.
#   secondary-keys:
#     h, -, " = join horizontally
#     v, |, % = join vertically
#     f, @ = join full scree
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @sessionist-new "S"

# Zoom pane to separate window and then unzoom back to original location
# Prefix + Z = Toggle
set -g @plugin 'jaclu/tmux-power-zoom'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
